<?php
/**
 * OpenElo - Translations
 */

$translations = [
    'en' => [
        // General
        'site_title' => 'OpenElo',
        'site_tagline' => 'Open Chess Rating System',
        'site_description' => 'A free, decentralized Elo rating system for chess communities outside FIDE circuits.',

        // Navigation
        'nav_home' => 'Home',
        'nav_circuits' => 'Circuits',
        'nav_rankings' => 'Rankings',
        'nav_submit_result' => 'Submit Result',
        'nav_create' => 'Create',

        // Landing page
        'hero_title' => 'Your Rating, Your Circuit',
        'hero_subtitle' => 'A decentralized Elo rating system built on trust, not bureaucracy.',
        'hero_cta' => 'Explore Circuits',
        'hero_create' => 'Create Circuit',

        'feature_1_title' => 'Local Trust',
        'feature_1_desc' => 'Ratings are valid within trust circuits. No central authority, just community validation.',
        'feature_2_title' => 'Email-Based',
        'feature_2_desc' => 'No passwords, no logins. Everything works through email confirmations.',
        'feature_3_title' => 'Triple Validation',
        'feature_3_desc' => 'Every match requires confirmation from both players and the club president.',
        'feature_4_title' => 'FIDE-style K Factor',
        'feature_4_desc' => 'K=40 for new players, K=20 under 2200, K=10 above. Familiar and fair.',

        'how_it_works' => 'How It Works',
        'step_1' => 'Create or join a circuit',
        'step_2' => 'Register your club',
        'step_3' => 'Add players',
        'step_4' => 'Submit and validate matches',
        'step_5' => 'Watch ratings evolve',

        // Forms
        'form_name' => 'Name',
        'form_email' => 'Email',
        'form_first_name' => 'First Name',
        'form_last_name' => 'Last Name',
        'form_circuit' => 'Circuit',
        'form_club' => 'Club',
        'form_player' => 'Player',
        'form_white' => 'White',
        'form_black' => 'Black',
        'form_result' => 'Result',
        'form_submit' => 'Submit',
        'form_cancel' => 'Cancel',

        'result_white_wins' => 'White wins (1-0)',
        'result_black_wins' => 'Black wins (0-1)',
        'result_draw' => 'Draw (½-½)',

        // Circuit
        'circuit_create' => 'Create Circuit',
        'circuit_name' => 'Circuit Name',
        'circuit_owner_email' => 'Owner Email',
        'circuit_created' => 'Circuit created! Check your email to confirm.',
        'circuit_clubs' => 'Clubs',
        'circuit_players' => 'Players',
        'circuit_matches' => 'Matches',

        // Club
        'club_create' => 'Create Club',
        'club_name' => 'Club Name',
        'club_president_email' => 'President Email',
        'club_created' => 'Club created! Check your email to confirm.',
        'club_join_circuit' => 'Join Circuit',
        'club_request_sent' => 'Request sent! The circuit owner will receive an email.',

        // Player
        'player_register' => 'Register Player',
        'player_registered' => 'Player registered! Check your email to confirm.',
        'player_rating' => 'Rating',
        'player_games' => 'Games',

        // Match
        'match_submit' => 'Submit Match Result',
        'match_submitted' => 'Match submitted! All parties will receive confirmation emails.',
        'match_pending' => 'Pending confirmations',
        'match_confirmed' => 'Confirmed',

        // Confirmation
        'confirm_success' => 'Confirmed successfully!',
        'confirm_error' => 'Invalid or expired token.',
        'confirm_already' => 'Already confirmed.',

        // Rankings
        'rankings_title' => 'Rankings',
        'rankings_position' => '#',
        'rankings_player' => 'Player',
        'rankings_club' => 'Club',
        'rankings_rating' => 'Rating',
        'rankings_games' => 'Games',

        // Errors
        'error_required' => 'This field is required.',
        'error_email' => 'Invalid email address.',
        'error_not_found' => 'Not found.',
        'error_generic' => 'An error occurred. Please try again.',

        // Footer
        'footer_text' => 'OpenElo is open source software.',
        'footer_github' => 'View on GitHub',
    ],

    'it' => [
        // General
        'site_title' => 'OpenElo',
        'site_tagline' => 'Sistema di Rating Scacchistico Aperto',
        'site_description' => 'Un sistema Elo gratuito e decentralizzato per comunità scacchistiche fuori dai circuiti FIDE.',

        // Navigation
        'nav_home' => 'Home',
        'nav_circuits' => 'Circuiti',
        'nav_rankings' => 'Classifiche',
        'nav_submit_result' => 'Inserisci Risultato',
        'nav_create' => 'Crea',

        // Landing page
        'hero_title' => 'Il Tuo Rating, Il Tuo Circuito',
        'hero_subtitle' => 'Un sistema Elo decentralizzato basato sulla fiducia, non sulla burocrazia.',
        'hero_cta' => 'Esplora Circuiti',
        'hero_create' => 'Crea Circuito',

        'feature_1_title' => 'Fiducia Locale',
        'feature_1_desc' => 'I rating sono validi nei circuiti di fiducia. Nessuna autorità centrale, solo validazione della comunità.',
        'feature_2_title' => 'Basato su Email',
        'feature_2_desc' => 'Niente password, niente login. Tutto funziona tramite conferme via email.',
        'feature_3_title' => 'Tripla Validazione',
        'feature_3_desc' => 'Ogni partita richiede conferma di entrambi i giocatori e del presidente del circolo.',
        'feature_4_title' => 'Fattore K stile FIDE',
        'feature_4_desc' => 'K=40 per nuovi giocatori, K=20 sotto 2200, K=10 sopra. Familiare e giusto.',

        'how_it_works' => 'Come Funziona',
        'step_1' => 'Crea o unisciti a un circuito',
        'step_2' => 'Registra il tuo circolo',
        'step_3' => 'Aggiungi giocatori',
        'step_4' => 'Inserisci e valida le partite',
        'step_5' => 'Guarda evolvere i rating',

        // Forms
        'form_name' => 'Nome',
        'form_email' => 'Email',
        'form_first_name' => 'Nome',
        'form_last_name' => 'Cognome',
        'form_circuit' => 'Circuito',
        'form_club' => 'Circolo',
        'form_player' => 'Giocatore',
        'form_white' => 'Bianco',
        'form_black' => 'Nero',
        'form_result' => 'Risultato',
        'form_submit' => 'Invia',
        'form_cancel' => 'Annulla',

        'result_white_wins' => 'Vince il Bianco (1-0)',
        'result_black_wins' => 'Vince il Nero (0-1)',
        'result_draw' => 'Patta (½-½)',

        // Circuit
        'circuit_create' => 'Crea Circuito',
        'circuit_name' => 'Nome Circuito',
        'circuit_owner_email' => 'Email Proprietario',
        'circuit_created' => 'Circuito creato! Controlla la tua email per confermare.',
        'circuit_clubs' => 'Circoli',
        'circuit_players' => 'Giocatori',
        'circuit_matches' => 'Partite',

        // Club
        'club_create' => 'Crea Circolo',
        'club_name' => 'Nome Circolo',
        'club_president_email' => 'Email Presidente',
        'club_created' => 'Circolo creato! Controlla la tua email per confermare.',
        'club_join_circuit' => 'Unisciti al Circuito',
        'club_request_sent' => 'Richiesta inviata! Il proprietario del circuito riceverà un\'email.',

        // Player
        'player_register' => 'Registra Giocatore',
        'player_registered' => 'Giocatore registrato! Controlla la tua email per confermare.',
        'player_rating' => 'Rating',
        'player_games' => 'Partite',

        // Match
        'match_submit' => 'Inserisci Risultato Partita',
        'match_submitted' => 'Partita inserita! Tutte le parti riceveranno email di conferma.',
        'match_pending' => 'Conferme in attesa',
        'match_confirmed' => 'Confermata',

        // Confirmation
        'confirm_success' => 'Confermato con successo!',
        'confirm_error' => 'Token non valido o scaduto.',
        'confirm_already' => 'Già confermato.',

        // Rankings
        'rankings_title' => 'Classifiche',
        'rankings_position' => '#',
        'rankings_player' => 'Giocatore',
        'rankings_club' => 'Circolo',
        'rankings_rating' => 'Rating',
        'rankings_games' => 'Partite',

        // Errors
        'error_required' => 'Campo obbligatorio.',
        'error_email' => 'Indirizzo email non valido.',
        'error_not_found' => 'Non trovato.',
        'error_generic' => 'Si è verificato un errore. Riprova.',

        // Footer
        'footer_text' => 'OpenElo è software open source.',
        'footer_github' => 'Vedi su GitHub',
    ],
];

/**
 * Get current language
 */
function getCurrentLang(): string {
    // 1. Check URL parameter
    if (isset($_GET['lang']) && in_array($_GET['lang'], SUPPORTED_LANGS)) {
        setcookie('openelo_lang', $_GET['lang'], time() + 86400 * 365, '/');
        return $_GET['lang'];
    }

    // 2. Check cookie
    if (isset($_COOKIE['openelo_lang']) && in_array($_COOKIE['openelo_lang'], SUPPORTED_LANGS)) {
        return $_COOKIE['openelo_lang'];
    }

    // 3. Auto-detect from browser
    if (isset($_SERVER['HTTP_ACCEPT_LANGUAGE'])) {
        $browserLang = substr($_SERVER['HTTP_ACCEPT_LANGUAGE'], 0, 2);
        if (in_array($browserLang, SUPPORTED_LANGS)) {
            return $browserLang;
        }
    }

    return DEFAULT_LANG;
}

/**
 * Translate key
 */
function __($key): string {
    global $translations;
    $lang = getCurrentLang();
    return $translations[$lang][$key] ?? $translations[DEFAULT_LANG][$key] ?? $key;
}

/**
 * Get all translations for current language
 */
function getTranslations(): array {
    global $translations;
    return $translations[getCurrentLang()];
}
